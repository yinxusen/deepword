
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>deepword.models package &#8212; DeepWord v4.0 documentation</title>
    <link rel="stylesheet" href="_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="shortcut icon" type="image/png" href="_static/py.png" />
    
    <script type="text/javascript" src="_static/copybutton.js"></script>
    
     

  </head><body>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
    <li><img src="_static/py.png" alt=""
             style="vertical-align: middle; margin-top: -1px"/></li>
    <li><a href="https://www.python.org/">Python</a> &#187;</li>
    
    <a href="index.html">DeepWord v4.0 documentation</a> &#187;
    

        <li class="nav-item nav-item-this"><a href="">deepword.models package</a></li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="search.html" method="get">
          <input placeholder="Quick search" type="text" name="q" />
          <input type="submit" value="Go" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>    

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="deepword-models-package">
<h1>deepword.models package<a class="headerlink" href="#deepword-models-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-deepword.models.dqn_modeling">
<span id="deepword-models-dqn-modeling-module"></span><h2>deepword.models.dqn_modeling module<a class="headerlink" href="#module-deepword.models.dqn_modeling" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="deepword.models.dqn_modeling.BaseDQN">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.dqn_modeling.</code><code class="sig-name descname">BaseDQN</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">src_embeddings</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">is_infer</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dqn_modeling.BaseDQN" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt id="deepword.models.dqn_modeling.BaseDQN.get_eval_model">
<em class="property">classmethod </em><code class="sig-name descname">get_eval_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dqn_modeling.BaseDQN.get_eval_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.dqn_modeling.BaseDQN.get_q_actions">
<code class="sig-name descname">get_q_actions</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dqn_modeling.BaseDQN.get_q_actions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.dqn_modeling.BaseDQN.get_train_model">
<em class="property">classmethod </em><code class="sig-name descname">get_train_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dqn_modeling.BaseDQN.get_train_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.dqn_modeling.BaseDQN.get_train_op">
<code class="sig-name descname">get_train_op</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">q_actions</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dqn_modeling.BaseDQN.get_train_op" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.dqn_modeling.BaseDQN.init_glove">
<em class="property">classmethod </em><code class="sig-name descname">init_glove</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">glove_path</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dqn_modeling.BaseDQN.init_glove" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="deepword.models.dqn_modeling.CnnDQN">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.dqn_modeling.</code><code class="sig-name descname">CnnDQN</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">src_embeddings</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">is_infer</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dqn_modeling.CnnDQN" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#deepword.models.dqn_modeling.BaseDQN" title="deepword.models.dqn_modeling.BaseDQN"><code class="xref py py-class docutils literal notranslate"><span class="pre">deepword.models.dqn_modeling.BaseDQN</span></code></a></p>
<dl class="py method">
<dt id="deepword.models.dqn_modeling.CnnDQN.get_q_actions">
<code class="sig-name descname">get_q_actions</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dqn_modeling.CnnDQN.get_q_actions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.dqn_modeling.CnnDQN.get_train_op">
<code class="sig-name descname">get_train_op</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">q_actions</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dqn_modeling.CnnDQN.get_train_op" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="deepword.models.dqn_modeling.LstmDQN">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.dqn_modeling.</code><code class="sig-name descname">LstmDQN</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">src_embeddings</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">is_infer</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dqn_modeling.LstmDQN" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#deepword.models.dqn_modeling.BaseDQN" title="deepword.models.dqn_modeling.BaseDQN"><code class="xref py py-class docutils literal notranslate"><span class="pre">deepword.models.dqn_modeling.BaseDQN</span></code></a></p>
<dl class="py method">
<dt id="deepword.models.dqn_modeling.LstmDQN.get_q_actions">
<code class="sig-name descname">get_q_actions</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dqn_modeling.LstmDQN.get_q_actions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.dqn_modeling.LstmDQN.get_train_op">
<code class="sig-name descname">get_train_op</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">q_actions</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dqn_modeling.LstmDQN.get_train_op" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-deepword.models.drrn_modeling">
<span id="deepword-models-drrn-modeling-module"></span><h2>deepword.models.drrn_modeling module<a class="headerlink" href="#module-deepword.models.drrn_modeling" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="deepword.models.drrn_modeling.BertDRRN">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.drrn_modeling.</code><code class="sig-name descname">BertDRRN</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">src_embeddings</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">is_infer</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.drrn_modeling.BertDRRN" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#deepword.models.drrn_modeling.CnnDRRN" title="deepword.models.drrn_modeling.CnnDRRN"><code class="xref py py-class docutils literal notranslate"><span class="pre">deepword.models.drrn_modeling.CnnDRRN</span></code></a></p>
<dl class="py method">
<dt id="deepword.models.drrn_modeling.BertDRRN.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">src_embeddings</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">is_infer</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.drrn_modeling.BertDRRN.__init__" title="Permalink to this definition">¶</a></dt>
<dd><dl>
<dt>inputs:</dt><dd><p>src: source sentences to encode
src_len: length of source sentences
action_idx: the action chose to run
expected_q: E(q) computed from the iterative equation of DQN
actions: all possible actions
actions_len: length of actions
actions_mask: a 0-1 vector of size <a href="#id1"><span class="problematic" id="id2">|actions|</span></a>, using 0 to eliminate</p>
<blockquote>
<div><p>some actions for a certain state.</p>
</div></blockquote>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hp</strong> – </p></li>
<li><p><strong>is_infer</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="deepword.models.drrn_modeling.BertDRRN.get_q_actions">
<code class="sig-name descname">get_q_actions</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.drrn_modeling.BertDRRN.get_q_actions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="deepword.models.drrn_modeling.CnnDRRN">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.drrn_modeling.</code><code class="sig-name descname">CnnDRRN</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">src_embeddings</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">is_infer</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.drrn_modeling.CnnDRRN" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#deepword.models.dqn_modeling.BaseDQN" title="deepword.models.dqn_modeling.BaseDQN"><code class="xref py py-class docutils literal notranslate"><span class="pre">deepword.models.dqn_modeling.BaseDQN</span></code></a></p>
<dl class="py method">
<dt id="deepword.models.drrn_modeling.CnnDRRN.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">src_embeddings</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">is_infer</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.drrn_modeling.CnnDRRN.__init__" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>inputs:</dt><dd><p>src: source sentences to encode
src_len: length of source sentences
action_idx: the action chose to run
expected_q: E(q) computed from the iterative equation of DQN
actions: all possible actions
actions_len: length of actions</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hp</strong> – </p></li>
<li><p><strong>is_infer</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="deepword.models.drrn_modeling.CnnDRRN.get_eval_model">
<em class="property">classmethod </em><code class="sig-name descname">get_eval_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.drrn_modeling.CnnDRRN.get_eval_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.drrn_modeling.CnnDRRN.get_eval_student_model">
<em class="property">classmethod </em><code class="sig-name descname">get_eval_student_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.drrn_modeling.CnnDRRN.get_eval_student_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.drrn_modeling.CnnDRRN.get_q_actions">
<code class="sig-name descname">get_q_actions</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.drrn_modeling.CnnDRRN.get_q_actions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.drrn_modeling.CnnDRRN.get_train_model">
<em class="property">classmethod </em><code class="sig-name descname">get_train_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.drrn_modeling.CnnDRRN.get_train_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.drrn_modeling.CnnDRRN.get_train_op">
<code class="sig-name descname">get_train_op</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">q_actions</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.drrn_modeling.CnnDRRN.get_train_op" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.drrn_modeling.CnnDRRN.get_train_student_model">
<em class="property">classmethod </em><code class="sig-name descname">get_train_student_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.drrn_modeling.CnnDRRN.get_train_student_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="deepword.models.drrn_modeling.TransformerDRRN">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.drrn_modeling.</code><code class="sig-name descname">TransformerDRRN</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">src_embeddings</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">is_infer</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.drrn_modeling.TransformerDRRN" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#deepword.models.drrn_modeling.CnnDRRN" title="deepword.models.drrn_modeling.CnnDRRN"><code class="xref py py-class docutils literal notranslate"><span class="pre">deepword.models.drrn_modeling.CnnDRRN</span></code></a></p>
<dl class="py method">
<dt id="deepword.models.drrn_modeling.TransformerDRRN.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">src_embeddings</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">is_infer</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.drrn_modeling.TransformerDRRN.__init__" title="Permalink to this definition">¶</a></dt>
<dd><dl>
<dt>inputs:</dt><dd><p>src: source sentences to encode
src_len: length of source sentences
action_idx: the action chose to run
expected_q: E(q) computed from the iterative equation of DQN
actions: all possible actions
actions_len: length of actions
actions_mask: a 0-1 vector of size <a href="#id3"><span class="problematic" id="id4">|actions|</span></a>, using 0 to eliminate</p>
<blockquote>
<div><p>some actions for a certain state.</p>
</div></blockquote>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hp</strong> – </p></li>
<li><p><strong>src_embeddings</strong> – </p></li>
<li><p><strong>is_infer</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="deepword.models.drrn_modeling.TransformerDRRN.get_q_actions">
<code class="sig-name descname">get_q_actions</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.drrn_modeling.TransformerDRRN.get_q_actions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-deepword.models.dsqn_modeling">
<span id="deepword-models-dsqn-modeling-module"></span><h2>deepword.models.dsqn_modeling module<a class="headerlink" href="#module-deepword.models.dsqn_modeling" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="deepword.models.dsqn_modeling.CnnDSQN">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.dsqn_modeling.</code><code class="sig-name descname">CnnDSQN</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">src_embeddings</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">is_infer</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dsqn_modeling.CnnDSQN" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#deepword.models.dqn_modeling.BaseDQN" title="deepword.models.dqn_modeling.BaseDQN"><code class="xref py py-class docutils literal notranslate"><span class="pre">deepword.models.dqn_modeling.BaseDQN</span></code></a></p>
<p>DSQN that uses CNN as the trajectory encoder</p>
<dl class="py method">
<dt id="deepword.models.dsqn_modeling.CnnDSQN.get_eval_model">
<em class="property">classmethod </em><code class="sig-name descname">get_eval_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dsqn_modeling.CnnDSQN.get_eval_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.dsqn_modeling.CnnDSQN.get_h_state">
<code class="sig-name descname">get_h_state</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">src</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dsqn_modeling.CnnDSQN.get_h_state" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.dsqn_modeling.CnnDSQN.get_merged_train_op">
<code class="sig-name descname">get_merged_train_op</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">loss</span></em>, <em class="sig-param"><span class="n">snn_loss</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dsqn_modeling.CnnDSQN.get_merged_train_op" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.dsqn_modeling.CnnDSQN.get_q_actions">
<code class="sig-name descname">get_q_actions</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dsqn_modeling.CnnDSQN.get_q_actions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.dsqn_modeling.CnnDSQN.get_snn_train_op">
<code class="sig-name descname">get_snn_train_op</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">semantic_same</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dsqn_modeling.CnnDSQN.get_snn_train_op" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.dsqn_modeling.CnnDSQN.get_train_model">
<em class="property">classmethod </em><code class="sig-name descname">get_train_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dsqn_modeling.CnnDSQN.get_train_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.dsqn_modeling.CnnDSQN.get_train_op">
<code class="sig-name descname">get_train_op</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">q_actions</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dsqn_modeling.CnnDSQN.get_train_op" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.dsqn_modeling.CnnDSQN.get_train_student_model">
<em class="property">classmethod </em><code class="sig-name descname">get_train_student_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dsqn_modeling.CnnDSQN.get_train_student_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.dsqn_modeling.CnnDSQN.is_semantic_same">
<code class="sig-name descname">is_semantic_same</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dsqn_modeling.CnnDSQN.is_semantic_same" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="deepword.models.dsqn_modeling.CnnZorkDSQN">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.dsqn_modeling.</code><code class="sig-name descname">CnnZorkDSQN</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">src_embeddings</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">is_infer</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dsqn_modeling.CnnZorkDSQN" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#deepword.models.dsqn_modeling.CnnDSQN" title="deepword.models.dsqn_modeling.CnnDSQN"><code class="xref py py-class docutils literal notranslate"><span class="pre">deepword.models.dsqn_modeling.CnnDSQN</span></code></a></p>
<p>DSQN for Zork</p>
<dl class="py method">
<dt id="deepword.models.dsqn_modeling.CnnZorkDSQN.get_eval_model">
<em class="property">classmethod </em><code class="sig-name descname">get_eval_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dsqn_modeling.CnnZorkDSQN.get_eval_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.dsqn_modeling.CnnZorkDSQN.get_train_model">
<em class="property">classmethod </em><code class="sig-name descname">get_train_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dsqn_modeling.CnnZorkDSQN.get_train_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.dsqn_modeling.CnnZorkDSQN.get_train_op">
<code class="sig-name descname">get_train_op</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">q_actions</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dsqn_modeling.CnnZorkDSQN.get_train_op" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="deepword.models.dsqn_modeling.TransformerDSQN">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.dsqn_modeling.</code><code class="sig-name descname">TransformerDSQN</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">src_embeddings</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">is_infer</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dsqn_modeling.TransformerDSQN" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#deepword.models.dsqn_modeling.CnnDSQN" title="deepword.models.dsqn_modeling.CnnDSQN"><code class="xref py py-class docutils literal notranslate"><span class="pre">deepword.models.dsqn_modeling.CnnDSQN</span></code></a></p>
<p>DSQN that uses transformer as the trajectory encoder</p>
<dl class="py method">
<dt id="deepword.models.dsqn_modeling.TransformerDSQN.get_h_state">
<code class="sig-name descname">get_h_state</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">src</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.dsqn_modeling.TransformerDSQN.get_h_state" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-deepword.models.gen_modeling">
<span id="deepword-models-gen-modeling-module"></span><h2>deepword.models.gen_modeling module<a class="headerlink" href="#module-deepword.models.gen_modeling" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="deepword.models.gen_modeling.TransformerGenDQN">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.gen_modeling.</code><code class="sig-name descname">TransformerGenDQN</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">is_infer</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.gen_modeling.TransformerGenDQN" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#deepword.models.dqn_modeling.BaseDQN" title="deepword.models.dqn_modeling.BaseDQN"><code class="xref py py-class docutils literal notranslate"><span class="pre">deepword.models.dqn_modeling.BaseDQN</span></code></a></p>
<dl class="py method">
<dt id="deepword.models.gen_modeling.TransformerGenDQN.decode">
<code class="sig-name descname">decode</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.gen_modeling.TransformerGenDQN.decode" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.gen_modeling.TransformerGenDQN.get_eval_model">
<em class="property">classmethod </em><code class="sig-name descname">get_eval_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.gen_modeling.TransformerGenDQN.get_eval_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.gen_modeling.TransformerGenDQN.get_q_actions">
<code class="sig-name descname">get_q_actions</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.gen_modeling.TransformerGenDQN.get_q_actions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.gen_modeling.TransformerGenDQN.get_train_model">
<em class="property">classmethod </em><code class="sig-name descname">get_train_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.gen_modeling.TransformerGenDQN.get_train_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.gen_modeling.TransformerGenDQN.get_train_op">
<code class="sig-name descname">get_train_op</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">q_actions</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.gen_modeling.TransformerGenDQN.get_train_op" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.gen_modeling.TransformerGenDQN.get_train_student_model">
<em class="property">classmethod </em><code class="sig-name descname">get_train_student_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.gen_modeling.TransformerGenDQN.get_train_student_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="deepword.models.gen_modeling.TransformerPGN">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.gen_modeling.</code><code class="sig-name descname">TransformerPGN</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">is_infer</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.gen_modeling.TransformerPGN" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#deepword.models.gen_modeling.TransformerGenDQN" title="deepword.models.gen_modeling.TransformerGenDQN"><code class="xref py py-class docutils literal notranslate"><span class="pre">deepword.models.gen_modeling.TransformerGenDQN</span></code></a></p>
<p>TransformerPGN is similar with TransformerGenDQN, the only difference is
the former uses cross entropy loss, while the latter uses MSE.
Thus, TransformerPGN is not allowed training with the DQN framework.
It can only be trained with supervised learning, e.g. imitation learning.</p>
<dl class="py method">
<dt id="deepword.models.gen_modeling.TransformerPGN.get_train_op">
<code class="sig-name descname">get_train_op</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">q_actions</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.gen_modeling.TransformerPGN.get_train_op" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>b_weight could be</dt><dd><ol class="arabic simple">
<li><p>per instance, i.e. [batch_size, 1]</p></li>
<li><p>per token, i.e. [batch_size, n_tokens]</p></li>
</ol>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-deepword.models.models">
<span id="deepword-models-models-module"></span><h2>deepword.models.models module<a class="headerlink" href="#module-deepword.models.models" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="deepword.models.models.DQNModel">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.models.</code><code class="sig-name descname">DQNModel</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">graph</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Graph</span></em>, <em class="sig-param"><span class="n">q_actions</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Tensor</span></em>, <em class="sig-param"><span class="n">src_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">src_len_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">action_idx_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">train_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">loss</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">expected_q_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">b_weight_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">train_summary_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">abs_loss</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">src_seg_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">h_state</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.models.DQNModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
</dd></dl>

<dl class="py class">
<dt id="deepword.models.models.DRRNModel">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.models.</code><code class="sig-name descname">DRRNModel</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">graph</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Graph</span></em>, <em class="sig-param"><span class="n">q_actions</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Tensor</span></em>, <em class="sig-param"><span class="n">src_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">src_len_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">action_idx_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">train_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">loss</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">expected_q_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">b_weight_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">train_summary_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">abs_loss</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">src_seg_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">h_state</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">actions_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">actions_len_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">actions_repeats_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.models.DRRNModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#deepword.models.models.DQNModel" title="deepword.models.models.DQNModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">deepword.models.models.DQNModel</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt id="deepword.models.models.DSQNModel">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.models.</code><code class="sig-name descname">DSQNModel</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">graph</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Graph</span></em>, <em class="sig-param"><span class="n">q_actions</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Tensor</span></em>, <em class="sig-param"><span class="n">src_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">src_len_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">action_idx_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">train_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">loss</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">expected_q_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">b_weight_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">train_summary_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">abs_loss</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">src_seg_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">h_state</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">actions_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">actions_len_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">actions_repeats_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">snn_train_summary_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">weighted_train_summary_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">semantic_same</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Tensor</span></em>, <em class="sig-param"><span class="n">snn_src_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">snn_src_len_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">snn_src2_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">snn_src2_len_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">labels_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">snn_loss</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">weighted_loss</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">merged_train_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">snn_train_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">h_states_diff</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.models.DSQNModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#deepword.models.models.DRRNModel" title="deepword.models.models.DRRNModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">deepword.models.models.DRRNModel</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt id="deepword.models.models.DSQNZorkModel">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.models.</code><code class="sig-name descname">DSQNZorkModel</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">graph</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Graph</span></em>, <em class="sig-param"><span class="n">q_actions</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Tensor</span></em>, <em class="sig-param"><span class="n">src_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">src_len_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">action_idx_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">train_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">loss</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">expected_q_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">b_weight_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">train_summary_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">abs_loss</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">src_seg_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">h_state</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">snn_train_summary_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">weighted_train_summary_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">semantic_same</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Tensor</span></em>, <em class="sig-param"><span class="n">snn_src_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">snn_src_len_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">snn_src2_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">snn_src2_len_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">labels_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">snn_loss</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">weighted_loss</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">merged_train_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">snn_train_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">h_states_diff</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.models.DSQNZorkModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#deepword.models.models.DQNModel" title="deepword.models.models.DQNModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">deepword.models.models.DQNModel</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt id="deepword.models.models.GenDQNModel">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.models.</code><code class="sig-name descname">GenDQNModel</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">graph</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Graph</span></em>, <em class="sig-param"><span class="n">q_actions</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Tensor</span></em>, <em class="sig-param"><span class="n">src_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">src_len_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">action_idx_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">train_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">loss</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">expected_q_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">b_weight_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">train_summary_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">abs_loss</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">src_seg_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">h_state</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">decoded_idx_infer</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Tensor</span></em>, <em class="sig-param"><span class="n">action_idx_out_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">action_len_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">temperature_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">p_gen</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Tensor</span></em>, <em class="sig-param"><span class="n">p_gen_infer</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Tensor</span></em>, <em class="sig-param"><span class="n">beam_size_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">use_greedy_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">col_eos_idx</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Tensor</span></em>, <em class="sig-param"><span class="n">decoded_logits_infer</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Tensor</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.models.GenDQNModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#deepword.models.models.DQNModel" title="deepword.models.models.DQNModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">deepword.models.models.DQNModel</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt id="deepword.models.models.NLUModel">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.models.</code><code class="sig-name descname">NLUModel</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">graph</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Graph</span></em>, <em class="sig-param"><span class="n">q_actions</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Tensor</span></em>, <em class="sig-param"><span class="n">src_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">src_len_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">action_idx_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">train_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">loss</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">expected_q_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">b_weight_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">train_summary_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">classification_train_summary_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">abs_loss</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">src_seg_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">h_state</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">seg_tj_action_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">swag_labels_</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.ops.array_ops.placeholder<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">classification_loss</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">classification_train_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.models.NLUModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#deepword.models.models.DQNModel" title="deepword.models.models.DQNModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">deepword.models.models.DQNModel</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt id="deepword.models.models.SNNModel">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.models.</code><code class="sig-name descname">SNNModel</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">graph</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Graph</span></em>, <em class="sig-param"><span class="n">target_src_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">same_src_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">diff_src_</span><span class="p">:</span> <span class="n">tensorflow.python.ops.array_ops.placeholder</span></em>, <em class="sig-param"><span class="n">semantic_same</span><span class="p">:</span> <span class="n">tensorflow.python.framework.ops.Operation</span></em>, <em class="sig-param"><span class="n">train_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">loss</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">train_summary_op</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>tensorflow.python.framework.ops.Operation<span class="p">]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.models.SNNModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
</dd></dl>

</div>
<div class="section" id="module-deepword.models.nlu_modeling">
<span id="deepword-models-nlu-modeling-module"></span><h2>deepword.models.nlu_modeling module<a class="headerlink" href="#module-deepword.models.nlu_modeling" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="deepword.models.nlu_modeling.AlbertNLU">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.nlu_modeling.</code><code class="sig-name descname">AlbertNLU</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">is_infer</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.nlu_modeling.AlbertNLU" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#deepword.models.nlu_modeling.BertNLU" title="deepword.models.nlu_modeling.BertNLU"><code class="xref py py-class docutils literal notranslate"><span class="pre">deepword.models.nlu_modeling.BertNLU</span></code></a></p>
<dl class="py method">
<dt id="deepword.models.nlu_modeling.AlbertNLU.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">is_infer</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.nlu_modeling.AlbertNLU.__init__" title="Permalink to this definition">¶</a></dt>
<dd><dl>
<dt>inputs:</dt><dd><dl class="simple">
<dt>src: source sentences to encode,</dt><dd><p>has paddings, [CLS], and [SEP] prepared</p>
</dd>
</dl>
<p>src_len: length of source sentences
action_idx: the action chose to run
expected_q: E(q) computed from the iterative equation of DQN
actions: all possible actions
actions_len: length of actions
actions_mask: a 0-1 vector of size <a href="#id5"><span class="problematic" id="id6">|actions|</span></a>, using 0 to eliminate</p>
<blockquote>
<div><p>some actions for a certain state.</p>
</div></blockquote>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hp</strong> – </p></li>
<li><p><strong>is_infer</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="deepword.models.nlu_modeling.AlbertNLU.get_q_actions">
<code class="sig-name descname">get_q_actions</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.nlu_modeling.AlbertNLU.get_q_actions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="deepword.models.nlu_modeling.BertNLU">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.nlu_modeling.</code><code class="sig-name descname">BertNLU</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">is_infer</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.nlu_modeling.BertNLU" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#deepword.models.dqn_modeling.BaseDQN" title="deepword.models.dqn_modeling.BaseDQN"><code class="xref py py-class docutils literal notranslate"><span class="pre">deepword.models.dqn_modeling.BaseDQN</span></code></a></p>
<dl class="py method">
<dt id="deepword.models.nlu_modeling.BertNLU.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">is_infer</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.nlu_modeling.BertNLU.__init__" title="Permalink to this definition">¶</a></dt>
<dd><dl>
<dt>inputs:</dt><dd><dl class="simple">
<dt>src: source sentences to encode,</dt><dd><p>has paddings, [CLS], and [SEP] prepared</p>
</dd>
</dl>
<p>src_len: length of source sentences
action_idx: the action chose to run
expected_q: E(q) computed from the iterative equation of DQN
actions: all possible actions
actions_len: length of actions
actions_mask: a 0-1 vector of size <a href="#id7"><span class="problematic" id="id8">|actions|</span></a>, using 0 to eliminate</p>
<blockquote>
<div><p>some actions for a certain state.</p>
</div></blockquote>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hp</strong> – </p></li>
<li><p><strong>is_infer</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="deepword.models.nlu_modeling.BertNLU.get_classification_train_op">
<code class="sig-name descname">get_classification_train_op</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">q_actions</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.nlu_modeling.BertNLU.get_classification_train_op" title="Permalink to this definition">¶</a></dt>
<dd><p>q_actions: [batch_size, 1]
in this case, when we want to compute classification error, we need
the batch_size = src batch size * num classes
which means that number of classes for each src should be equal
:param q_actions:
:return:</p>
</dd></dl>

<dl class="py method">
<dt id="deepword.models.nlu_modeling.BertNLU.get_eval_model">
<em class="property">classmethod </em><code class="sig-name descname">get_eval_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.nlu_modeling.BertNLU.get_eval_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.nlu_modeling.BertNLU.get_eval_student_model">
<em class="property">classmethod </em><code class="sig-name descname">get_eval_student_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.nlu_modeling.BertNLU.get_eval_student_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.nlu_modeling.BertNLU.get_q_actions">
<code class="sig-name descname">get_q_actions</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.nlu_modeling.BertNLU.get_q_actions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.nlu_modeling.BertNLU.get_train_model">
<em class="property">classmethod </em><code class="sig-name descname">get_train_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.nlu_modeling.BertNLU.get_train_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.nlu_modeling.BertNLU.get_train_op">
<code class="sig-name descname">get_train_op</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">q_actions</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.nlu_modeling.BertNLU.get_train_op" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.nlu_modeling.BertNLU.get_train_student_model">
<em class="property">classmethod </em><code class="sig-name descname">get_train_student_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.nlu_modeling.BertNLU.get_train_student_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt id="deepword.models.nlu_modeling.create_eval_bert_nlu_model">
<code class="sig-prename descclassname">deepword.models.nlu_modeling.</code><code class="sig-name descname">create_eval_bert_nlu_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">model_creator</span></em>, <em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.nlu_modeling.create_eval_bert_nlu_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="deepword.models.nlu_modeling.create_train_bert_nlu_model">
<code class="sig-prename descclassname">deepword.models.nlu_modeling.</code><code class="sig-name descname">create_train_bert_nlu_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">model_creator</span></em>, <em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.nlu_modeling.create_train_bert_nlu_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-deepword.models.snn_modeling">
<span id="deepword-models-snn-modeling-module"></span><h2>deepword.models.snn_modeling module<a class="headerlink" href="#module-deepword.models.snn_modeling" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="deepword.models.snn_modeling.BertSNN">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.snn_modeling.</code><code class="sig-name descname">BertSNN</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">is_infer</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.snn_modeling.BertSNN" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Use SNN to encode sentences for additive features representation learning</p>
<dl class="py method">
<dt id="deepword.models.snn_modeling.BertSNN.add_cls_token">
<code class="sig-name descname">add_cls_token</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">src</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.snn_modeling.BertSNN.add_cls_token" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.snn_modeling.BertSNN.get_eval_model">
<em class="property">classmethod </em><code class="sig-name descname">get_eval_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.snn_modeling.BertSNN.get_eval_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.snn_modeling.BertSNN.get_eval_student_model">
<em class="property">classmethod </em><code class="sig-name descname">get_eval_student_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.snn_modeling.BertSNN.get_eval_student_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.snn_modeling.BertSNN.get_h_state">
<code class="sig-name descname">get_h_state</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">raw_src</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.snn_modeling.BertSNN.get_h_state" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.snn_modeling.BertSNN.get_train_model">
<em class="property">classmethod </em><code class="sig-name descname">get_train_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.snn_modeling.BertSNN.get_train_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.snn_modeling.BertSNN.get_train_op">
<code class="sig-name descname">get_train_op</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">semantic_same</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.snn_modeling.BertSNN.get_train_op" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.snn_modeling.BertSNN.get_train_student_model">
<em class="property">classmethod </em><code class="sig-name descname">get_train_student_model</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">hp</span></em>, <em class="sig-param"><span class="n">device_placement</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.snn_modeling.BertSNN.get_train_student_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="deepword.models.snn_modeling.BertSNN.is_semantic_same">
<code class="sig-name descname">is_semantic_same</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.snn_modeling.BertSNN.is_semantic_same" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-deepword.models.transformer">
<span id="deepword-models-transformer-module"></span><h2>deepword.models.transformer module<a class="headerlink" href="#module-deepword.models.transformer" title="Permalink to this headline">¶</a></h2>
<p>Copied from <a class="reference external" href="https://www.tensorflow.org/beta/tutorials/text/transformer">https://www.tensorflow.org/beta/tutorials/text/transformer</a>
decode function added by Xusen Yin</p>
<dl class="py class">
<dt id="deepword.models.transformer.Decoder">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.transformer.</code><code class="sig-name descname">Decoder</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">num_layers</span></em>, <em class="sig-param"><span class="n">d_model</span></em>, <em class="sig-param"><span class="n">num_heads</span></em>, <em class="sig-param"><span class="n">dff</span></em>, <em class="sig-param"><span class="n">tgt_vocab_size</span></em>, <em class="sig-param"><span class="n">dropout_rate</span><span class="o">=</span><span class="default_value">0.1</span></em>, <em class="sig-param"><span class="n">with_pointer</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.Decoder" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tensorflow.python.keras.engine.base_layer.Layer</span></code></p>
<dl class="py method">
<dt id="deepword.models.transformer.Decoder.call">
<code class="sig-name descname">call</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">enc_x</span></em>, <em class="sig-param"><span class="n">enc_output</span></em>, <em class="sig-param"><span class="n">training</span></em>, <em class="sig-param"><span class="n">look_ahead_mask</span></em>, <em class="sig-param"><span class="n">padding_mask</span></em>, <em class="sig-param"><span class="n">copy_mask</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.Decoder.call" title="Permalink to this definition">¶</a></dt>
<dd><p>decode with pointer</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – decoder input</p></li>
<li><p><strong>enc_x</strong> – encoder input</p></li>
<li><p><strong>enc_output</strong> – encoder encoded result</p></li>
<li><p><strong>training</strong> – is training or inference</p></li>
<li><p><strong>look_ahead_mask</strong> – combined look ahead mask with padding mask</p></li>
<li><p><strong>padding_mask</strong> – padding mask for source sentence</p></li>
<li><p><strong>copy_mask</strong> – dense vector size <a href="#id9"><span class="problematic" id="id10">|V|</span></a> to mark all tokens that
skip copying with 1; otherwise, 0.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>total logits, probability of generation, gen logits, copy logits</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="deepword.models.transformer.DecoderLayer">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.transformer.</code><code class="sig-name descname">DecoderLayer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">d_model</span></em>, <em class="sig-param"><span class="n">num_heads</span></em>, <em class="sig-param"><span class="n">dff</span></em>, <em class="sig-param"><span class="n">rate</span><span class="o">=</span><span class="default_value">0.1</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.DecoderLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tensorflow.python.keras.engine.base_layer.Layer</span></code></p>
<dl class="py method">
<dt id="deepword.models.transformer.DecoderLayer.call">
<code class="sig-name descname">call</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">enc_output</span></em>, <em class="sig-param"><span class="n">training</span></em>, <em class="sig-param"><span class="n">look_ahead_mask</span></em>, <em class="sig-param"><span class="n">padding_mask</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.DecoderLayer.call" title="Permalink to this definition">¶</a></dt>
<dd><p>This is where the layer’s logic lives.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> – Input tensor, or list/tuple of input tensors.</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tensor or list/tuple of tensors.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="deepword.models.transformer.Encoder">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.transformer.</code><code class="sig-name descname">Encoder</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">num_layers</span></em>, <em class="sig-param"><span class="n">d_model</span></em>, <em class="sig-param"><span class="n">num_heads</span></em>, <em class="sig-param"><span class="n">dff</span></em>, <em class="sig-param"><span class="n">input_vocab_size</span></em>, <em class="sig-param"><span class="n">dropout_rate</span><span class="o">=</span><span class="default_value">0.1</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.Encoder" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tensorflow.python.keras.engine.base_layer.Layer</span></code></p>
<dl class="py method">
<dt id="deepword.models.transformer.Encoder.call">
<code class="sig-name descname">call</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">training</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">mask</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">x_seg</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.Encoder.call" title="Permalink to this definition">¶</a></dt>
<dd><p>This is where the layer’s logic lives.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> – Input tensor, or list/tuple of input tensors.</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tensor or list/tuple of tensors.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="deepword.models.transformer.EncoderLayer">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.transformer.</code><code class="sig-name descname">EncoderLayer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">d_model</span></em>, <em class="sig-param"><span class="n">num_heads</span></em>, <em class="sig-param"><span class="n">dff</span></em>, <em class="sig-param"><span class="n">rate</span><span class="o">=</span><span class="default_value">0.1</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.EncoderLayer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tensorflow.python.keras.engine.base_layer.Layer</span></code></p>
<dl class="py method">
<dt id="deepword.models.transformer.EncoderLayer.call">
<code class="sig-name descname">call</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">training</span></em>, <em class="sig-param"><span class="n">mask</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.EncoderLayer.call" title="Permalink to this definition">¶</a></dt>
<dd><p>This is where the layer’s logic lives.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> – Input tensor, or list/tuple of input tensors.</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tensor or list/tuple of tensors.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="deepword.models.transformer.MultiHeadAttention">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.transformer.</code><code class="sig-name descname">MultiHeadAttention</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">d_model</span></em>, <em class="sig-param"><span class="n">num_heads</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.MultiHeadAttention" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tensorflow.python.keras.engine.base_layer.Layer</span></code></p>
<dl class="py method">
<dt id="deepword.models.transformer.MultiHeadAttention.call">
<code class="sig-name descname">call</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">v</span></em>, <em class="sig-param"><span class="n">k</span></em>, <em class="sig-param"><span class="n">q</span></em>, <em class="sig-param"><span class="n">mask</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.MultiHeadAttention.call" title="Permalink to this definition">¶</a></dt>
<dd><p>This is where the layer’s logic lives.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> – Input tensor, or list/tuple of input tensors.</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tensor or list/tuple of tensors.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="deepword.models.transformer.MultiHeadAttention.split_heads">
<code class="sig-name descname">split_heads</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">batch_size</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.MultiHeadAttention.split_heads" title="Permalink to this definition">¶</a></dt>
<dd><p>Split the last dimension into (num_heads, depth).
Transpose the result such that the shape is</p>
<blockquote>
<div><p>(batch_size, num_heads, seq_len, depth)</p>
</div></blockquote>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="deepword.models.transformer.Transformer">
<em class="property">class </em><code class="sig-prename descclassname">deepword.models.transformer.</code><code class="sig-name descname">Transformer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">num_layers</span></em>, <em class="sig-param"><span class="n">d_model</span></em>, <em class="sig-param"><span class="n">num_heads</span></em>, <em class="sig-param"><span class="n">dff</span></em>, <em class="sig-param"><span class="n">input_vocab_size</span></em>, <em class="sig-param"><span class="n">target_vocab_size</span></em>, <em class="sig-param"><span class="n">dropout_rate</span><span class="o">=</span><span class="default_value">0.1</span></em>, <em class="sig-param"><span class="n">with_pointer</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.Transformer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tensorflow.python.keras.engine.training.Model</span></code></p>
<dl class="py method">
<dt id="deepword.models.transformer.Transformer.call">
<code class="sig-name descname">call</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">inp</span></em>, <em class="sig-param"><span class="n">tar</span></em>, <em class="sig-param"><span class="n">training</span></em>, <em class="sig-param"><span class="n">copy_mask</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.Transformer.call" title="Permalink to this definition">¶</a></dt>
<dd><p>Calls the model on new inputs.</p>
<p>In this case <cite>call</cite> just reapplies
all ops in the graph to the new inputs
(e.g. build a new computational graph from the provided inputs).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> – A tensor or list of tensors.</p></li>
<li><p><strong>training</strong> – Boolean or boolean scalar tensor, indicating whether to run
the <cite>Network</cite> in training mode or inference mode.</p></li>
<li><p><strong>mask</strong> – A mask or list of masks. A mask can be
either a tensor or None (no mask).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tensor if there is a single output, or
a list of tensors if there are more than one outputs.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="deepword.models.transformer.Transformer.decode">
<code class="sig-name descname">decode</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">enc_x</span></em>, <em class="sig-param"><span class="n">training</span></em>, <em class="sig-param"><span class="n">max_tar_len</span></em>, <em class="sig-param"><span class="n">sos_id</span></em>, <em class="sig-param"><span class="n">eos_id</span></em>, <em class="sig-param"><span class="n">padding_id</span></em>, <em class="sig-param"><span class="n">use_greedy</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">beam_size</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">temperature</span><span class="o">=</span><span class="default_value">1.0</span></em>, <em class="sig-param"><span class="n">copy_mask</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.Transformer.decode" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt id="deepword.models.transformer.categorical_with_replacement">
<code class="sig-prename descclassname">deepword.models.transformer.</code><code class="sig-name descname">categorical_with_replacement</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">logits</span></em>, <em class="sig-param"><span class="n">k</span><span class="p">:</span> <span class="n">int</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.categorical_with_replacement" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="deepword.models.transformer.categorical_without_replacement">
<code class="sig-prename descclassname">deepword.models.transformer.</code><code class="sig-name descname">categorical_without_replacement</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">logits</span></em>, <em class="sig-param"><span class="n">k</span><span class="p">:</span> <span class="n">int</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.categorical_without_replacement" title="Permalink to this definition">¶</a></dt>
<dd><p>Courtesy of <a class="reference external" href="https://github.com/tensorflow/tensorflow/issues/">https://github.com/tensorflow/tensorflow/issues/</a>    9260#issuecomment-437875125
also cite here:
&#64;misc{vieira2014gumbel,</p>
<blockquote>
<div><p>title = {Gumbel-max trick and weighted reservoir sampling},
author = {Tim Vieira},
url = {<a class="reference external" href="http://timvieira.github.io/blog/post/2014/08/01/">http://timvieira.github.io/blog/post/2014/08/01/</a>        gumbel-max-trick-and-weighted-reservoir-sampling/},
year = {2014}</p>
</div></blockquote>
<p>}
Notice that the logits represent unnormalized log probabilities,
in the citation above, there is no need to normalized them first to add
the Gumbel random variant, which surprises me! since I thought it should
be <cite>logits - tf.reduce_logsumexp(logits) + z</cite></p>
</dd></dl>

<dl class="py function">
<dt id="deepword.models.transformer.create_decode_masks">
<code class="sig-prename descclassname">deepword.models.transformer.</code><code class="sig-name descname">create_decode_masks</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">tar</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.create_decode_masks" title="Permalink to this definition">¶</a></dt>
<dd><p>Create masking for decoding</p>
<p>This masking combines the look ahead mask and target sentence padding mask.</p>
<ol class="arabic simple">
<li><p>We create look ahead mask for each sentence;</p></li>
<li><p>We combine the sentence padding mask with the look ahead mask, e.g. when
the look ahead mask says “0” for a token, while the sentence padding mask
says “1” for the same token because of the token is a padding, then the
final mask for this token is “1”.</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tar</strong> – target sentence, shape: (batch_size, seq_len_k)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(batch_size,
1, seq_len_k, seq_len_k)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>a combined mask of look ahead mask and padding mask, shape</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tar_src</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">create_decode_masks</span><span class="p">(</span><span class="n">tar_src</span><span class="p">)</span>
<span class="go">array([[[[0., 1., 1., 1., 1., 1.],</span>
<span class="go">         [0., 0., 1., 1., 1., 1.],</span>
<span class="go">         [0., 0., 0., 1., 1., 1.],</span>
<span class="go">         [0., 0., 0., 0., 1., 1.],</span>
<span class="go">         [0., 0., 0., 0., 1., 1.],</span>
<span class="go">         [0., 0., 0., 0., 1., 1.]]],</span>
<span class="go">       [[[0., 1., 1., 1., 1., 1.],</span>
<span class="go">         [0., 0., 1., 1., 1., 1.],</span>
<span class="go">         [0., 0., 1., 1., 1., 1.],</span>
<span class="go">         [0., 0., 1., 1., 1., 1.],</span>
<span class="go">         [0., 0., 1., 1., 1., 1.],</span>
<span class="go">         [0., 0., 1., 1., 1., 1.]]]], dtype=float32)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="deepword.models.transformer.create_look_ahead_mask">
<code class="sig-prename descclassname">deepword.models.transformer.</code><code class="sig-name descname">create_look_ahead_mask</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">size</span><span class="p">:</span> <span class="n">int</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.create_look_ahead_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>create look ahead mask for decoding</p>
<p>At every decoding step i, only t_0, …, t_i can be accessed by the model,
while t_{i+1}, …, t_n should be masked out.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>size</strong> – decoding output size</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>look ahead mask, True means masked out.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">create_look_ahead_mask</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="go">array([[0., 1., 1.],</span>
<span class="go">       [0., 0., 1.],</span>
<span class="go">       [0., 0., 0.]], dtype=float32)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="deepword.models.transformer.create_padding_mask">
<code class="sig-prename descclassname">deepword.models.transformer.</code><code class="sig-name descname">create_padding_mask</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">seq</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.create_padding_mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Padding value should be 0.
This mask contains one dimension for num_heads, i.e.
(batch_size, &lt;broadcast to num_heads&gt;, &lt;broadcast to seq_len_q&gt;, seq_len_k)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>seq</strong> – (batch_size, seq_len_k)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>padding mask, paddings is set to True, others are False
shape: (batch_size, 1, 1, seq_len_k)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="deepword.models.transformer.decode_next_step">
<code class="sig-prename descclassname">deepword.models.transformer.</code><code class="sig-name descname">decode_next_step</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">decoder</span></em>, <em class="sig-param"><span class="n">time</span></em>, <em class="sig-param"><span class="n">enc_x</span></em>, <em class="sig-param"><span class="n">enc_output</span></em>, <em class="sig-param"><span class="n">training</span></em>, <em class="sig-param"><span class="n">dec_padding_mask</span></em>, <em class="sig-param"><span class="n">copy_mask</span></em>, <em class="sig-param"><span class="n">batch_size</span></em>, <em class="sig-param"><span class="n">tgt_vocab_size</span></em>, <em class="sig-param"><span class="n">eos_id</span></em>, <em class="sig-param"><span class="n">padding_id</span></em>, <em class="sig-param"><span class="n">beam_size</span></em>, <em class="sig-param"><span class="n">use_greedy</span></em>, <em class="sig-param"><span class="n">temperature</span></em>, <em class="sig-param"><span class="n">inc_tar</span></em>, <em class="sig-param"><span class="n">inc_continue</span></em>, <em class="sig-param"><span class="n">inc_valid_len</span></em>, <em class="sig-param"><span class="n">inc_p_gen</span></em>, <em class="sig-param"><span class="n">inc_sum_logits</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.decode_next_step" title="Permalink to this definition">¶</a></dt>
<dd><p>decode one step with beam search
given inc_tar as the current decoded target sequence
(batch_size * beam_size), first decode one step with decoder to get
decoded_logits.
then mask the decoded_logits:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>if continue to decode (i.e. eos never reached) and current time
reach the max_tar_len, then only EOS is allowed to choose;</p></li>
<li><p>if not continue to decode, only PAD is allowed to choose;</p></li>
<li><p>default, we don’t mask the decoded_logits.</p></li>
</ol>
</div></blockquote>
<p>After get predicted_id, either by sampling method or greedy method,
we compute 1) beam_id and 2) token_id from predicted_id.
beam_id indicates which beam to choose, token_id indicates under that
beam, which token to choose.</p>
<p>for loop variables, inc_tar, inc_continue, inc_logits, inc_valid_len,
and inc_p_gen, we first select rows according to beam_id, then pad
the token_id related info to the end. e.g. given beam_size = 2,
batch_size = 2, we have inc_tar:</p>
<dl>
<dt>[[[1, 2, 3],</dt><dd><blockquote>
<div><p>[2, 3, 4]],  # –&gt; this beam row will be deleted</p>
</div></blockquote>
<dl class="simple">
<dt>[[9, 8, 7],</dt><dd><p>[8, 7, 6]]]</p>
</dd>
</dl>
</dd>
</dl>
<p>if beam_id = [[0, 0], [0, 1]], then we choose [1, 2, 3] twice, and
[9, 8, 7] once, and [8, 7, 6] once, then make the inc_tar to be
[[[1, 2, 3],</p>
<blockquote>
<div><blockquote>
<div><p>[1, 2, 3]],</p>
</div></blockquote>
<dl class="simple">
<dt>[[9, 8, 7],</dt><dd><p>[8, 7, 6]]]</p>
</dd>
</dl>
</div></blockquote>
<p>then pad new token_id to the end.</p>
</dd></dl>

<dl class="py function">
<dt id="deepword.models.transformer.get_sparse_idx_for_copy">
<code class="sig-prename descclassname">deepword.models.transformer.</code><code class="sig-name descname">get_sparse_idx_for_copy</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">src</span></em>, <em class="sig-param"><span class="n">target_seq_len</span><span class="p">:</span> <span class="n">int</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.get_sparse_idx_for_copy" title="Permalink to this definition">¶</a></dt>
<dd><p>Create sparse index from source sentence for copying into decoder using
the <cite>tf.scatter_nd</cite> method.</p>
<p>Considering the following source sentence: “a, b, a, c”; turn it into
indices: [0, 1, 0, 2], and they have attention weights
attn = [a0, a1, a2, a3].</p>
<p>Now we want to decode a sentence with 3 tokens, for each generated token, we
want to collect attention weights from the source sentence, and mix with
the logits to generate the current token.</p>
<p>I.e. for decoded sentence position i, we have
logits(i) = [0.1, 0.2, 0.3, 0.5] for all possible tokens a, b, c, d.
Then we want to sum the attention weights of two-0s, one-1, and one-2 into
the logits(i) according to a generation weight p(i), i.e. total logits =
logits(i) * p(i) + [a0 + a2, a1, a3, 0] * (1 - p(i)).</p>
<p>The goal is to create a dense vector of vocabulary size, and copy attention
weights from source sentence to the dense vector.</p>
<p>We create a inverse index to do so. For target token i, we need to collect
[(0, a0), (1, a1), (0, a2), (2, a3)] to construct the vector.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>src</strong> – source sentence</p></li>
<li><p><strong>target_seq_len</strong> – target sequence len</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>sparse index to construct attention weight matrix for a batch</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">get_sparse_idx_for_copy</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]],</span> <span class="n">target_seq_len</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="go">array([[[[0, 0],</span>
<span class="go">         [0, 1],</span>
<span class="go">         [0, 0],</span>
<span class="go">         [0, 2]],</span>
<span class="go">        [[1, 0],</span>
<span class="go">         [1, 1],</span>
<span class="go">         [1, 0],</span>
<span class="go">         [1, 2]],</span>
<span class="go">        [[2, 0],</span>
<span class="go">         [2, 1],</span>
<span class="go">         [2, 0],</span>
<span class="go">         [2, 2]]]], dtype=int32)</span>
<span class="go">shape: (1, 3, 4, 2)  # batch_size, target sentence len, source sentence</span>
<span class="go">len, 2D matrix indices</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="deepword.models.transformer.nucleus_renormalization">
<code class="sig-prename descclassname">deepword.models.transformer.</code><code class="sig-name descname">nucleus_renormalization</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">logits</span></em>, <em class="sig-param"><span class="n">p</span><span class="o">=</span><span class="default_value">0.95</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.nucleus_renormalization" title="Permalink to this definition">¶</a></dt>
<dd><p>Refer to [Holtzman et al., 2020] for nucleus sampling</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>logits</strong> – last-dimension logits of vocabulary V;
2D array, [batch, V] or [batch*beam, V]</p></li>
<li><p><strong>p</strong> – the cumulative probability bound, default 0.95;</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>normalized nucleus logits</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="deepword.models.transformer.point_wise_feed_forward_network">
<code class="sig-prename descclassname">deepword.models.transformer.</code><code class="sig-name descname">point_wise_feed_forward_network</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">d_model</span></em>, <em class="sig-param"><span class="n">dff</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.point_wise_feed_forward_network" title="Permalink to this definition">¶</a></dt>
<dd><p>Two dense layers, one with activation, the second without activation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>d_model</strong> – model size</p></li>
<li><p><strong>dff</strong> – intermediate size</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>FFN(x)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="deepword.models.transformer.scaled_dot_product_attention">
<code class="sig-prename descclassname">deepword.models.transformer.</code><code class="sig-name descname">scaled_dot_product_attention</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">q</span></em>, <em class="sig-param"><span class="n">k</span></em>, <em class="sig-param"><span class="n">v</span></em>, <em class="sig-param"><span class="n">mask</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.scaled_dot_product_attention" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the attention weights.
q, k, v must have matching leading dimensions.
k, v must have matching penultimate dimension, i.e.: seq_len_k = seq_len_v.
The mask has different shapes depending on its type(padding or look ahead)
but it must be broadcastable for addition.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>q</strong> – query shape == (…, seq_len_q, depth)</p></li>
<li><p><strong>k</strong> – key shape == (…, seq_len_k, depth)</p></li>
<li><p><strong>v</strong> – value shape == (…, seq_len_v, depth_v)</p></li>
<li><p><strong>mask</strong> – Float tensor with shape broadcastable
to (…, seq_len_q, seq_len_k). Defaults to None.</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Notice that mask must have the same dimensions as q, k, v.</dt><dd><p>e.g. if q, k, v are (batch_size, num_heads, seq_len, depth), then the mask
should be also (batch_size, num_heads, seq_len, depth).
However, if q, k, v are (batch_size, seq_len, depth), then the mask should
also not contain num_heads.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>output (a.k.a. context vectors), scaled_attention_logits</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="deepword.models.transformer.sequential_decoding">
<code class="sig-prename descclassname">deepword.models.transformer.</code><code class="sig-name descname">sequential_decoding</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">decoder</span></em>, <em class="sig-param"><span class="n">copy_mask</span></em>, <em class="sig-param"><span class="n">enc_x</span></em>, <em class="sig-param"><span class="n">enc_output</span></em>, <em class="sig-param"><span class="n">training</span></em>, <em class="sig-param"><span class="n">max_tar_len</span></em>, <em class="sig-param"><span class="n">sos_id</span></em>, <em class="sig-param"><span class="n">eos_id</span></em>, <em class="sig-param"><span class="n">padding_id</span></em>, <em class="sig-param"><span class="n">use_greedy</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">beam_size</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">temperature</span><span class="o">=</span><span class="default_value">1.0</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.sequential_decoding" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="deepword.models.transformer.token_logit_masking">
<code class="sig-prename descclassname">deepword.models.transformer.</code><code class="sig-name descname">token_logit_masking</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">token_id</span><span class="p">:</span> <span class="n">int</span></em>, <em class="sig-param"><span class="n">vocab_size</span><span class="p">:</span> <span class="n">int</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.transformer.token_logit_masking" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate logits to choose the token_id. e.g. with vocab_size = 10,
token_id = 0, we have
[  0., -inf, -inf, -inf, -inf, -inf, -inf, -inf, -inf, -inf]
plus this mask with normal logits, only token_id=0 can be chose</p>
</dd></dl>

</div>
<div class="section" id="module-deepword.models.utils">
<span id="deepword-models-utils-module"></span><h2>deepword.models.utils module<a class="headerlink" href="#module-deepword.models.utils" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="deepword.models.utils.encoder_cnn">
<code class="sig-prename descclassname">deepword.models.utils.</code><code class="sig-name descname">encoder_cnn</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">src</span></em>, <em class="sig-param"><span class="n">src_embeddings</span></em>, <em class="sig-param"><span class="n">pos_embeddings</span></em>, <em class="sig-param"><span class="n">filter_sizes</span></em>, <em class="sig-param"><span class="n">num_filters</span></em>, <em class="sig-param"><span class="n">embedding_size</span></em>, <em class="sig-param"><span class="n">is_infer</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">num_channels</span><span class="o">=</span><span class="default_value">2</span></em>, <em class="sig-param"><span class="n">activation</span><span class="o">=</span><span class="default_value">'tanh'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.utils.encoder_cnn" title="Permalink to this definition">¶</a></dt>
<dd><p>encode state with CNN, refer to
Convolutional Neural Networks for Sentence Classification</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>src</strong> – placeholder, (tf.int32, [batch_size, seq_len])</p></li>
<li><p><strong>src_embeddings</strong> – (tf.float32, [vocab_size, embedding_size])</p></li>
<li><p><strong>pos_embeddings</strong> – (tf.float32, [max_position_size, embedding_size])</p></li>
<li><p><strong>filter_sizes</strong> – list of ints, e.g. [3, 4, 5]</p></li>
<li><p><strong>num_filters</strong> – number of filters of each filter_size</p></li>
<li><p><strong>embedding_size</strong> – embedding size</p></li>
<li><p><strong>is_infer</strong> – training or inference</p></li>
<li><p><strong>num_channels</strong> – 1 or 2.</p></li>
<li><p><strong>activation</strong> – tanh (default) or relu</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a vector as the inner state</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="deepword.models.utils.encoder_cnn_base">
<code class="sig-prename descclassname">deepword.models.utils.</code><code class="sig-name descname">encoder_cnn_base</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">input_tensor</span></em>, <em class="sig-param"><span class="n">filter_sizes</span></em>, <em class="sig-param"><span class="n">num_filters</span></em>, <em class="sig-param"><span class="n">num_channels</span></em>, <em class="sig-param"><span class="n">embedding_size</span></em>, <em class="sig-param"><span class="n">is_infer</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">activation</span><span class="o">=</span><span class="default_value">'tanh'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.utils.encoder_cnn_base" title="Permalink to this definition">¶</a></dt>
<dd><p>We pad input_tensor in the head for each string to generate equal-size
output. E.g.</p>
<p>go north forest path this is a path …
given conv-filter size 3, it will be padded in the head with two tokens
&lt;S&gt; &lt;S&gt; go north forest path this is a path … OR
[PAD] [PAD] go north forest path this is a path …</p>
<p>the type of padding values doesn’t matter only if it is a special token, and
be identical for each model.</p>
<p>We use constant value 0 here, so make sure index-0 is a special token
that can be used to pad in your vocabulary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_tensor</strong> – (tf.float32,
[batch_size, seq_len, embedding_size, num_channels])</p></li>
<li><p><strong>filter_sizes</strong> – list of ints, e.g. [3, 4, 5]</p></li>
<li><p><strong>num_filters</strong> – number of filters for each filter size</p></li>
<li><p><strong>num_channels</strong> – 1 or 2, depending on the input tensor</p></li>
<li><p><strong>embedding_size</strong> – word embedding size</p></li>
<li><p><strong>is_infer</strong> – training or infer</p></li>
<li><p><strong>activation</strong> – choose from “tanh” or “relu”. Notice that if choose relu,
make sure adding an extra dense layer, otherwise the output is all
non-negative values.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a vector as the inner state</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="deepword.models.utils.encoder_lstm">
<code class="sig-prename descclassname">deepword.models.utils.</code><code class="sig-name descname">encoder_lstm</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">src</span></em>, <em class="sig-param"><span class="n">src_len</span></em>, <em class="sig-param"><span class="n">src_embeddings</span></em>, <em class="sig-param"><span class="n">num_units</span></em>, <em class="sig-param"><span class="n">num_layers</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.utils.encoder_lstm" title="Permalink to this definition">¶</a></dt>
<dd><p>encode state with LSTM</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>src</strong> – placeholder, (tf.int32, [None, None])</p></li>
<li><p><strong>src_len</strong> – placeholder, (tf.float32, [None])</p></li>
<li><p><strong>src_embeddings</strong> – (tf.float32, [vocab_size, embedding_size])</p></li>
<li><p><strong>num_units</strong> – number of LSTM units</p></li>
<li><p><strong>num_layers</strong> – number of LSTM layers</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>inner states (c, h)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="deepword.models.utils.l2_loss_1d_action">
<code class="sig-prename descclassname">deepword.models.utils.</code><code class="sig-name descname">l2_loss_1d_action</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">q_actions</span></em>, <em class="sig-param"><span class="n">action_idx</span></em>, <em class="sig-param"><span class="n">expected_q</span></em>, <em class="sig-param"><span class="n">b_weight</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.utils.l2_loss_1d_action" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>l2 loss for 1D action space. only q values in q_actions</dt><dd><p>selected by action_idx will be computed against expected_q</p>
</dd>
</dl>
<p>e.g. “go east” would be one whole action.
action_idx should have the same dimension as expected_q</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>q_actions</strong> – q-values</p></li>
<li><p><strong>action_idx</strong> – placeholder, the action chose for the state,
in a format of (tf.int32, [None])</p></li>
<li><p><strong>expected_q</strong> – placeholder, the expected reward gained from the step,
in a format of (tf.float32, [None])</p></li>
<li><p><strong>b_weight</strong> – weights for each data point</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>l2 loss and l1 loss</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="deepword.models.utils.l2_loss_1d_action_v2">
<code class="sig-prename descclassname">deepword.models.utils.</code><code class="sig-name descname">l2_loss_1d_action_v2</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">q_actions</span></em>, <em class="sig-param"><span class="n">action_idx</span></em>, <em class="sig-param"><span class="n">expected_q</span></em>, <em class="sig-param"><span class="n">n_actions</span></em>, <em class="sig-param"><span class="n">b_weight</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.utils.l2_loss_1d_action_v2" title="Permalink to this definition">¶</a></dt>
<dd><p>l2 loss for 1D action space.
e.g. “go east” would be one whole action.</p>
<blockquote>
<div><p>q_actions: Q-vector of a state for all actions
action_idx: placeholder, the action chose for the state,</p>
<blockquote>
<div><p>in a format of (tf.int32, [None])</p>
</div></blockquote>
<dl class="simple">
<dt>expected_q: placeholder, the expected reward gained from the step,</dt><dd><p>in a format of (tf.float32, [None])</p>
</dd>
</dl>
<p>n_actions: number of total actions
b_weight: weights for each data point</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>l2 loss and l1 loss</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="deepword.models.utils.l2_loss_2d_action">
<code class="sig-prename descclassname">deepword.models.utils.</code><code class="sig-name descname">l2_loss_2d_action</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">q_actions</span></em>, <em class="sig-param"><span class="n">action_idx</span></em>, <em class="sig-param"><span class="n">expected_q</span></em>, <em class="sig-param"><span class="n">vocab_size</span></em>, <em class="sig-param"><span class="n">action_len</span></em>, <em class="sig-param"><span class="n">max_action_len</span></em>, <em class="sig-param"><span class="n">b_weight</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.utils.l2_loss_2d_action" title="Permalink to this definition">¶</a></dt>
<dd><p>l2 loss for 2D action space.
e.g. “go east” is an action composed by “go” and “east”.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>q_actions</strong> – Q-matrix of a state for all action-components, e.g. tokens</p></li>
<li><p><strong>action_idx</strong> – placeholder, the action-components chose for the state,
in a format of (tf.int32, [None, None])</p></li>
<li><p><strong>expected_q</strong> – placeholder, the expected reward gained from the step,
in a format of (tf.float32, [None])</p></li>
<li><p><strong>vocab_size</strong> – number of action-components</p></li>
<li><p><strong>action_len</strong> – length of each action in a format of (tf.int32, [None])</p></li>
<li><p><strong>max_action_len</strong> – maximum length of action</p></li>
<li><p><strong>b_weight</strong> – weights for each data point</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>l2 loss and l1 loss</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="deepword.models.utils.positional_encoding">
<code class="sig-prename descclassname">deepword.models.utils.</code><code class="sig-name descname">positional_encoding</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">position</span></em>, <em class="sig-param"><span class="n">d_model</span></em><span class="sig-paren">)</span><a class="headerlink" href="#deepword.models.utils.positional_encoding" title="Permalink to this definition">¶</a></dt>
<dd><p>Create position embeddings with sin/cos, not need to train</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>position</strong> – maximum position size</p></li>
<li><p><strong>d_model</strong> – embedding size</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>position embeddings in shape (1, position, d_model)</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-deepword.models">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-deepword.models" title="Permalink to this headline">¶</a></h2>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">deepword.models package</a><ul>
<li><a class="reference internal" href="#submodules">Submodules</a></li>
<li><a class="reference internal" href="#module-deepword.models.dqn_modeling">deepword.models.dqn_modeling module</a></li>
<li><a class="reference internal" href="#module-deepword.models.drrn_modeling">deepword.models.drrn_modeling module</a></li>
<li><a class="reference internal" href="#module-deepword.models.dsqn_modeling">deepword.models.dsqn_modeling module</a></li>
<li><a class="reference internal" href="#module-deepword.models.gen_modeling">deepword.models.gen_modeling module</a></li>
<li><a class="reference internal" href="#module-deepword.models.models">deepword.models.models module</a></li>
<li><a class="reference internal" href="#module-deepword.models.nlu_modeling">deepword.models.nlu_modeling module</a></li>
<li><a class="reference internal" href="#module-deepword.models.snn_modeling">deepword.models.snn_modeling module</a></li>
<li><a class="reference internal" href="#module-deepword.models.transformer">deepword.models.transformer module</a></li>
<li><a class="reference internal" href="#module-deepword.models.utils">deepword.models.utils module</a></li>
<li><a class="reference internal" href="#module-deepword.models">Module contents</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/deepword.models.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>  
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
    <li><img src="_static/py.png" alt=""
             style="vertical-align: middle; margin-top: -1px"/></li>
    <li><a href="https://www.python.org/">Python</a> &#187;</li>
    
    <a href="index.html">DeepWord v4.0 documentation</a> &#187;
    

        <li class="nav-item nav-item-this"><a href="">deepword.models package</a></li>
    <li class="right">
        

    <div class="inline-search" style="display: none" role="search">
        <form class="inline-search" action="search.html" method="get">
          <input placeholder="Quick search" type="text" name="q" />
          <input type="submit" value="Go" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
    </div>
    <script type="text/javascript">$('.inline-search').show(0);</script>
         |
    </li>

      </ul>
    </div>  
    <div class="footer">
    &copy; <a href="copyright.html">Copyright</a> 2020, Xusen Yin.
    <br />

    The Python Software Foundation is a non-profit corporation.
<a href="https://www.python.org/psf/donations/">Please donate.</a>
<br />
    <br />

    Last updated on None.
    
    <br />

    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>

  </body>
</html>